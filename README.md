# Цель и задачи проекта
Проект представляет собой веб-сервис, в основе которого языковая трансформерная модель ruBert. Модель обучена анализировать транскрибированные тексты телефонных разговоров Компании и определять, была ли предложена скидка клиенту, а также выявлять размер этой скидки. В качестве входных данных сервис получает обработанный файл в формате csv и после переработки выдает этот файл с помеченными тегами для каждого слова.
## Данные и обучение модели
Веб-сервис основан на до-обученной языковой модели ruBert (ссылка на backbone),поэтому важную роль играет как использованные данные для обучения, так и сам процесс обучения.
Данные с разметкой были подготовлены Заказчиком и представляют из себя переработанные тексты телефонных переговоров с удаленными знаками препинания и без прописных букв. В качестве разметки выделяются слова и словосочетания, содержащие упоминание о скидках и их величине. 
С точки зрения слов и словосочетаний, несущих для Клиента смысловую нагрузку, их доля в общем количестве слов чрезвычайна мала и составляет менее 1%. Соотношение же примеров, содержащих теги, отличные от нуля, и только нулевые теги составляет 5: 1 (на 5 текстов только с нулевыми тегами приходится 1 текст с отличными от нуля).

Для сглаживания дисбаланса классов при обучении модели нашей командой была добавлена процедура дополнения данных путем случайной замены числительных в текстах, где они помечены тегами (в utils.py – функция augement_data).
Дополнительно при обучении модели мы сократили количество обучаемых текстов, в которых были только нулевые теги. Из всех текстов, где для слов были только теги «О» мы взяли 75%.
В итоге обучающая выборка поменялась и соотношения текстов по тегам составило примерно 2:1.

В обучении нами также использовался подход деления всех входных текстовых данных на чанки определенной длины в словах. Мы проводили серию экспериментов и лучшие результаты дали чанки размером в 350-400 слов (в utils.py – функция split_to_chunk).
Детально код обучения и подготовки данных можно посмотреть в скрип train.py.
Обучение модели происходило с помощью библиотеки transformers c hugging face. Параметры обучения можно также посмотреть в скрипте train.py. Обучается модель на классификацию токенов.

Итоговые веса модели в скрипте сохранялись локально, но для загрузки на git hub были скопированы на hugging face.
## Архитектура веб-сервиса
В основе архитектуры – «наивный классификатор» по содержанию определенных слов и модель-классификатор токенов.

 ![image](https://github.com/shakhovak/samolet/assets/89096305/6dfadaed-0fa1-472d-8084-f8a21a7b3e60)

Основная задача классификатора отсечь те тексты, в которых однозначно нет ненулевых тегов и таким образом поменять пропорции тегов в текстах и сделать их похожими на обучающую выборку.
Использование классификатора позволило повысить скорость работы алгоритма почти в 2 раза: c 7,91 it/s до 11,45 it/s на CPU Interl Core i7-13700K

# Установка и развертывание
Вариант 1. Клонирование репозитория и установка зависимостей. Репозиторий проекта можно посмотреть по ссылке. В репозитории есть файл requirements.txt, с перечнем всех необходимых библиотек для инференса. После их установки можно запускать скрипт main.py. В качестве аргумента при запуске скрипта можно указать путь к файлу, который должен анализироваться.
git clone https://github.com/shakhovak/samolet.git
python main.py  --path to file

Вариант 2. Использование API. На основе Flask в файле api.py мы собрали небольшое приложение, которое позволяет загрузить собственный файл и получить переработанный. Или воспользоваться готовый файлом и посмотреть, как на его основе работает веб-сервис. Приложение развернуто из докер-образа на ВМ и доступно по ссылке http://158.160.56.153:5000/ 
При работе с собственном файлом важно, чтобы его формат был похож на тот, что использовался на соревновании.

![image](https://github.com/shakhovak/samolet/assets/89096305/637aff19-3e44-47f0-958c-e0bc5d4d6955)

Образ для flask-приложения можно скачать с докер-хаба (пока доступно) docker pull shakhovak/apisamolet:latest
Вариант 3. Использовать докер-образ для запуска файла main.py. Докер можно скачать с докер-хаба docker pull shakhovak/samolet:latest

